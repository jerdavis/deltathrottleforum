<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>The Delta Throttle &bull; View topic - Code breakdown and explaination</title>

<link href="styles/prosilver/theme/print.css" rel="stylesheet" type="text/css" />
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>The Delta Throttle</h1>
		<p><br /><a href="http://deltathrottle.com/forums/">http://deltathrottle.com/forums/</a></p>

		<h2>Code breakdown and explaination</h2>
		<p><a href="http://deltathrottle.com/forums/viewtopic.php?f=4&amp;t=9">http://deltathrottle.com/forums/viewtopic.php?f=4&amp;t=9</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>2</strong></div>
		
			<div class="post">
				<h3>Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Jan 10, 2015 3:47 am</strong></div>
				<div class="author">by <strong>chunks</strong></div>
				<div class="content">I am planning on building a delta throttle based off of your work, however I am fairly new to Arduino and coding of this nature, I am planning on using the code you have released but I would like to better understand how it all works, I've been reading up on forward kinematics and trying to wrap my head around the maths (I shined in English and History when at high school...). I was wondering if you wouldn't mind doing a detailed breakdown and explanation of your code? I understand this could be a lot of work and understand if its not possible for you to do so but it would be greatly appreciated if you could.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Jan 12, 2015 7:09 am</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">There is a really good explanation of delta kinematics on the Trossen robotics forum, which I used as a starting point for my code:<br /><!-- m --><a class="postlink" href="http://forums.trossenrobotics.com/tutorials/introduction-129/delta-robot-kinematics-3276/">http://forums.trossenrobotics.com/tutor ... tics-3276/</a><!-- m --><br /><br />I probably can't break down the whole thing, but some stuff you could conceivably need to change:<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php@f=4&amp;t=9&amp;sid=2da7d3261aa1b35db93cfc0fa069564e&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>//Geometry<br />float handle_rad = 1.75;&nbsp; &nbsp; &nbsp;// end effector<br />float base_rad = 1.75;&nbsp; &nbsp; &nbsp;// base<br />float pushrod_lng = 3.5;<br />float pivot_lng = 2.25;<br /><br />//Configuration<br />float deadzone = 0.1;&nbsp; // smaller values will be set to 0<br />int gain = 150;</code></dd></dl><br /><br />This is some configuration stuff.   You might want to tweak the deadzone to your liking.<br /><br /><dl class="codebox"><dt>Code: <a href="viewtopic.php@f=4&amp;t=9&amp;sid=2da7d3261aa1b35db93cfc0fa069564e&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>&nbsp; &nbsp; &nbsp; &nbsp; pinMode(2,&nbsp; INPUT);<br />&nbsp; &nbsp; &nbsp; &nbsp; pinMode(3,&nbsp; INPUT);<br />&nbsp; &nbsp; &nbsp; &nbsp; pinMode(4,&nbsp; INPUT);<br />&nbsp; &nbsp; &nbsp; &nbsp; digitalWrite(2,HIGH);<br />&nbsp; &nbsp; &nbsp; &nbsp; digitalWrite(3,HIGH);<br />&nbsp; &nbsp; &nbsp; &nbsp; digitalWrite(4,HIGH);</code></dd></dl><br /><br />Setting up the digital IO.  If you add more than three buttons, you will need to configure the additional IO pins the same as these.<br /><br /><dl class="codebox"><dt>Code: <a href="viewtopic.php@f=4&amp;t=9&amp;sid=2da7d3261aa1b35db93cfc0fa069564e&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>&nbsp; &nbsp;xZero = 0;<br />&nbsp; &nbsp;yZero = 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; zZero = zValue;</code></dd></dl><br /><br />Setting the zero point.  The X and Y zero points will always be the center, but the Z zero will be whatever the current Z position is when you first plug it in.<br /><br />Let me know if you have questions on something specific.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Jan 12, 2015 9:29 am</strong></div>
				<div class="author">by <strong>chunks</strong></div>
				<div class="content">Are the lengths on the armatures fixed? ie. If I were to make either of the arms shorter/longer would adjustments need to be made within the code?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Jan 14, 2015 9:46 pm</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">You would want to change the values up at the top in the geometry section, pushrod_lng and pivotarm_lng.  You will also want to increase or decrease the gain accordingly.  If you make the device smaller, increase the gain, if you make it larger, decrease the gain.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Mar 11, 2015 10:29 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">My push rod length measured from ball center to center is 3.25 and my link arm is coming out around 2.2. I'm updating those values in the code, but it's not entirely clear to me if I need to mess with the *_rad values, and how much I should adjust gain. When I first plugged things in my Z axis didn't seem to be working correctly, it wouldn't register a change unless it was pushed very far down. Also, my X and Y are not at 0 when at rest. This may be something I need to adjust because my socket for the D shaft is not fixed to my pivot, I had to eyeball it to line it up.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 12, 2015 7:01 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">Ok, I've got this hooked up and working in ED. Holy crap. What a tremendous difference! Combat flight feels so much better. The ship feels significantly more maneuverable.<br /><br />I have some drift along the x axis though, even with a dead zone. I'll need to keep tweaking things to see what to do about it. <br /><br />I also don't really know what to do with the Z axis. I tried clamping the throttle to my desk so I could pull up more effectively but I couldn't get much out of it. I can really only effectively do a negative z-axis move. Any thoughts on what settings I might adjust?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 12, 2015 7:44 pm</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">The way the code is set up, the z axis zero point is wherever the z axis is when you first plug it in.  What I do is this: rest my hand on the handle, not actively pressing down or up just resting my hand on the handle so the springs balance against the weight of my hand, then plug it in. <br /><br />Also, I recommend sticking it down with some double sided tape, or maybe glue a nice rubbery material to the base to hold it in place. Or just use clamps like you have.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 12, 2015 8:11 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content"><blockquote><div><cite>zdayton wrote:</cite>The way the code is set up, the z axis zero point is wherever the z axis is when you first plug it in.  What I do is this: rest my hand on the handle, not actively pressing down or up just resting my hand on the handle so the springs balance against the weight of my hand, then plug it in. <br /><br />Also, I recommend sticking it down with some double sided tape, or maybe glue a nice rubbery material to the base to hold it in place. Or just use clamps like you have.</div></blockquote><br /><br /><br />That makes sense. I think I saw a comment from you about that in your reddit post too. I'll give that a try tonight. I also saw some comment about adding a button to toggle the control to lock at 0,0,0. Did you make any progress on the code for that? I'd love to be able to lock it out for some actions. I absolutely loved flying with this thing in combat last night, but I did get myself blown up by a station trying to leave. Oops.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 19, 2015 8:45 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">I think I may have some code to track a button's state to act as a toggle for disabling flight control and locking all axis to zero. I haven't tested it in flight yet but I'll try tonight.<br /><br />I pushed the code to a fork on GitHub. You can review it here:<br /><br /><!-- m --><a class="postlink" href="https://github.com/jerdavis/DeltaThrottle/commit/3a6e5d51c335464f0f4c38ee7b447822ebd1e826">https://github.com/jerdavis/DeltaThrott ... 22ebd1e826</a><!-- m --></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 19, 2015 10:25 pm</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">Just a couple problems to fix. <br />1. you are treating the toggle button like  a normal button and pushing it through to windows. Don't know if that was what you wanted. (That's what the joy_st.buttons line does) .<br />2. And most importantly, your need a rising edge trigger for your toggle button, otherwise it will toggle continuously every iteration of the loop.  This is pseudo code but you want something like:<br />If (togglebutton == 1 and togglebuttonlast == 0)<br />    Toggle state<br />Togglebuttonlast = togglebutton</div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>1</strong> of <strong>2</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>