<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>The Delta Throttle &bull; View topic - Code breakdown and explaination</title>

<link href="styles/prosilver/theme/print.css" rel="stylesheet" type="text/css" />
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>The Delta Throttle</h1>
		<p><br /><a href="http://deltathrottle.com/forums/">http://deltathrottle.com/forums/</a></p>

		<h2>Code breakdown and explaination</h2>
		<p><a href="http://deltathrottle.com/forums/viewtopic.php?f=4&amp;t=9">http://deltathrottle.com/forums/viewtopic.php?f=4&amp;t=9</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>2</strong> of <strong>2</strong></div>
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Mar 19, 2015 10:34 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">I wasn't sure about the joySt.buttons inclusion. Figured that might be an issue. I'll remove it from there.<br /><br />I did see the reset every loop with an earlier bit of example code. Testing with some debug statements the code I uploaded appeared to be maintaining the correct state. throttleButtonState reads as one on a button press. When that reads as one the code switches the value of throttleState using the If-elseif block. Then an if statement checks to see if throttleState is triggered to 1 (locked) and overwrites the axis.<br /><br />Obviously I need to test this in flight still, but at least with debugging it seemed to be behaving the way I wanted. That being that pressing the button will trigger a state change.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 20, 2015 2:12 am</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">You aren't seeing the issue because there is a  1 sec loop delay while in debug mode.  Meaning the loop only activates once every second.  But if you hold down the button for 10 seconds you will see that the joystick state toggles every second, aka every iteration of the loop.  Once you remove the loop delay, it will toggle back and forth continuously, and there is no way of predicting what state it will be in when you remove your finger from the button.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 20, 2015 2:28 am</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">I'm actually flying with that code right now and it's working correctly. I did have to remove the debug statement, that delay was killer on throttle response <img src="images/smilies/icon_e_wink.gif" alt=";)" title="Wink" />. But otherwise the code is working as I expected based on my tests with the serial monitor. Take another look at it. <br /><br />After playing around with it, I'm tempted to only lock Z and maybe X but keep Y free. Letting go of the handle should still throttle to 0 and then forward and reverse would still function as a regular throttle. At least in ED it can be finicky to have all 3 axis unlocked when you jump to supercruise. I get &quot;align with target&quot; warnings frequently till I jostle to the left or right.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 20, 2015 2:38 pm</strong></div>
				<div class="author">by <strong>jeruw</strong></div>
				<div class="content">I flew for a few hours last night and the throttle lockout was working well. I could fly into an area, click that and all throttle input would go to 0. I'd just sit in space silently. Clicking the button a second time would unlock the throttle.<br /><br />I pushed a couple changes to the fork on Github this morning. I set debug to false again in case anyone tries the code. I should probably reset the pivot and pushrod lengths as well I suppose. I added a few comments as well. The final thing I did was tweak the throttle lock to only 0 Z and X. I'll try flying with that as soon as I can, but my expectation would be that it would make the Delta behave like a standard hotas throttle. Nullifying any vertical or horizontal thrust input but allowing changes to main engine throttle. This would still let you lock out the system in supercruise or an asteroid belt and expect that you could let go of the controls and your ship isn't going to start drifting in some random direction (up, usually). But allow you to use the control to throttle up for jump into supercruise or to control speed in supercruise.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Mar 21, 2015 4:59 am</strong></div>
				<div class="author">by <strong>Trollbug</strong></div>
				<div class="content">Yes, it's a good idea .</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Mar 21, 2015 8:45 pm</strong></div>
				<div class="author">by <strong>zdayton</strong></div>
				<div class="content">I want to do a couple different modes I think.  All on the same button.  Something like:<br /><br />Single press: Toggle throttle lock - lock throttle at current position<br />Double Press: Lock throttle at zero<br />Press and hold: Lock x and z while holding, or maybe do an expanded deadzone for high precision flying.  This was inspired after trying to scoop cargo in E:D, which is quit difficult with the delta throttle normally.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Apr 09, 2015 12:49 am</strong></div>
				<div class="author">by <strong>Nemesisghost</strong></div>
				<div class="content">So the way to have a reliable toggle is to use interrupts.  What I'm in the process of doing is having a button tied to an interrupt pin(pin 7 in my case) that toggles a boolean.  Then in my loop I check that boolean, if it's one value then I'll turn on a LED &amp; set my throttle to 0, if it's the other then it functions as normal.  Since I also want to be able to recalibrate the z-axis when I turn it back on, I'll be setting an initialize flag when I flip from Off to On in my interrupt method.  Then my loop can check that &amp; re-initialize at that point.<br /><br />To see a bit of what I'm working towards, here's my test code.<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php@f=4&amp;t=9&amp;start=10&amp;sid=2da7d3261aa1b35db93cfc0fa069564e&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>int outPin = 6;<br />int inPin = 7;<br />int interrupt = 4;<br />volatile bool state = true;<br /><br />void setup()<br />{<br />&nbsp; pinMode(outPin, OUTPUT);<br />&nbsp; pinMode(inPin, INPUT_PULLUP);<br />&nbsp; attachInterrupt(interrupt, blink, FALLING);<br />//&nbsp; Serial.begin(9600);<br />}<br /><br />void loop()<br />{<br />&nbsp; if(state)<br />&nbsp; &nbsp; digitalWrite(outPin, HIGH);<br />&nbsp; else<br />&nbsp; &nbsp; digitalWrite(outPin, LOW);<br />}<br /><br />void blink() {<br />&nbsp; state = !state;<br />//&nbsp; Serial.println(&quot;State Changed&quot;);<br />}<br /></code></dd></dl></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code breakdown and explaination</h3>
				<div class="date"><img src="styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Apr 09, 2015 12:53 am</strong></div>
				<div class="author">by <strong>Nemesisghost</strong></div>
				<div class="content">Oh, I forgot to add.  The Arduino Pro Micro has 5 pins with interrupt capabilities(0, 1, 2, 3, 7).  All but 7 are tied to other functionality, like SPI &amp; I2C.  When attachingInterrupt, you'll want to use either RISING or FALLING, so that it only fires once per button press.  All the others will fire 1x when pressed &amp; 1x when released.</div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>2</strong> of <strong>2</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>